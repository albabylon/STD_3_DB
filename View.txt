Представления - SQL-зaпpoc, которому присвоили имя и сохранили в базе данных

При работе с базами данных зачастую приходится многократно выполнять одни и те же запросы. 
Такие запросы могут быть сложными и обращаться ко многим таблицам.

Для того чтобы упростить получение данных для пользователей и не писать каждый раз сложные запросы, используются представления.

CREATE VIEW some_view AS 
SELECT 
  * 
FROM 
  table1 
WHERE 
  some_condition;

Представления используются по нескольким причинам:

-они позволяют сделать так, что разные пользователи базы данных будут видеть её по-разному;
-с их помощью можно ограничить доступ к данным, разрешая пользователям видеть только некоторые из строк или столбцов таблицы;
-они упрощают доступ к базе данных, показывая каждому пользователю именно те данные, которые ему нужны.


Если представление основано на очень сложном запросе, то прежде чем обращаться к нему, его приходится материализовывать. 
Это означает, что сначала выполняется запрос, определяющий представление. 
Его результаты сохраняются во временной (промежуточной) таблице, и уже из неё берутся данные для формирования результатов пользовательского запроса. 
После того как запрос выполнен и временная таблица больше не нужна, она удаляется.

Плюсы:
- осуществлять ограничения доступа
- позволяют упростить запросы
- скрывают устройство базы от пользователя
- использовать материализованные представления для уменьшения времени выполнения сложных запросов

Минусы:
- если в основе представления лежит сложный многотабличный запрос, то на его выполнение может уходить много времени
- если в вашей базе много представлений, то их поддержка в актуальном состоянии и разграничение доступов могут стать отдельной большой задачей
- если пользователь попытается обновить строки представления, то такой запрос придётся преобразовать, чтобы он обновлял строки исходных таблиц


Таким образом, материализованное представление выгодно использовать, когда данные в исходных таблицах обновляются редко, а запросов к представлению много.

CREATE MATERIALIZED VIEW products_for_5 AS 
SELECT 
  SUM(pos.amount), 
  prod.name 
FROM 
  positions AS pos 
  JOIN orders AS o ON pos.order_id = o.id 
  JOIN products AS prod ON prod.id = pos.product_id 
WHERE 
  o.client_id = 5 
GROUP BY 
  prod.id;